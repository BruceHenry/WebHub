### Stream接口
[教程地址：Stream接口](http://javascript.ruanyifeng.com/nodejs/stream.html)

---
### 目录
```
1. 概述
   1.1 概念
2. 可读数据流
   2.1 readable 属性
   2.2 read()
   2.3 _read()
   2.4 setEncoding()
   2.5 resume()
   2.6 pause()
   2.7 isPaused()
   2.8 pipe()
   2.9 unpipe()
   2.10 事件
3. 继承可读数据流接口
   3.1 实例： fs 模块的读数据流
4. 可写数据流
   4.1 writable属性
   4.2 write()
   4.3 cork()，uncork()
   4.4 setDefaultEncoding()
   4.5 end()
   4.6 事件
5. pipe 方法
6. 转换数据流
7. HTTP请求
8. fs模块
9. 错误处理
10. 参考链接
```

- 读数据是`read`事件，写数据是`write`事件，而数据块是事件附带的信息。Node 为这类情况提供了一个特殊接口`Stream`

---
### 1. 概述

#### 1.1  概念
- ”数据流“（stream）是处理系统缓存的一种方式
- Node应用程序有两种缓存的处理方式，第一种是等到所有数据接收完毕，一次性从缓存读取，这就是传统的读取文件的方式；第二种是采用“数据流”的方式，收到一块数据，就读取一块，即在数据还没有接收完成时，就开始处理它
- 第一种方式先将数据全部读入内存，然后处理，优点是符合直觉，流程非常自然，缺点是如果遇到大文件，要花很长时间，才能进入数据处理的步骤
- 第二种方式每次只读入数据的一小块，像“流水”一样，每当系统读入了一小块数据，就会触发一个事件，发出“新数据块”的信号。应用程序只要监听这个事件，就能掌握数据读取的进展，做出相应处理，这样就提高了程序的性能
- 一个对象只要部署了数据流接口，就可以从它读取数据，或者写入数据。Node内部很多涉及IO处理的对象，都部署了Stream接口，下面就是其中的一些
   *   文件读写
   *   HTTP 请求的读写
   *   TCP 连接
   *   标准输入输出

---
### 2. 可读数据流
- Stream 接口分成三类
   *   可读数据流接口，用于对外提供数据。
   *   可写数据流接口，用于写入数据。
   *   双向数据流接口，用于读取和写入数据，比如Node的tcp sockets、zlib、crypto都部署了这个接口

#### 2.1  readable 属性
- 一个数据流的`readable`属性返回一个布尔值。如果数据流是一个仍然打开的可读数据流，就返回`true`，否则返回`false`

#### 2.2  read()
- read方法从系统缓存读取并返回数据。如果读不到数据，则返回null

#### 2.3 _read()
- 可读数据流的`_read`方法，可以将数据放入可读数据流

#### 2.4 setEncoding()
- 调用该方法，会使得数据流返回指定编码的字符串，而不是缓存之中的二进制对象

#### 2.5 resume()
- `resume`方法会使得“可读数据流”继续释放`data`事件，即转为流动态

#### 2.6  pause()
- `pause`方法使得流动态的数据流，停止释放`data`事件，转而进入暂停态

#### 2.7 isPaused()
- 该方法返回一个布尔值，表示“可读数据流”被客户端手动暂停

#### 2.8 pipe()
- pipe方法是自动传送数据的机制，就像管道一样。它从“可读数据流”读出所有数据，将其写出指定的目的地。整个过程是自动的

#### 2.9 unpipe()
- 该方法移除pipe方法指定的数据流目的地

#### 2.10 事件
>略

---
### 3. 继承可读数据流接口
- 可读数据流又分成两种，一种是 pull 模式，自己拉数据，就好像用吸管吸水，只有你吸了，水才会上来；另一种是 push 模式，数据自动推送给你，就好像水从水龙头自动涌出来

#### 3.1 实例： fs 模块的读数据流
- fs模块的createReadStream方法，就可以创建一个读取数据的数据流

---
### 4. 可写数据流
- “可读数据流”用来对外释放数据，“可写数据流”则是用来接收数据。它允许你将数据写入某个目的地。它是数据写入的一种抽象，不同的数据目的地部署了这个接口以后，就可以用统一的方法写入

#### 4.1 writable属性
- `writable`属性返回一个布尔值。如果数据流仍然打开，并且可写，就返回`true`，否则返回`false`

#### 4.2 write()
- `write`方法用于向“可写数据流”写入数据。它接受两个参数，一个是写入的内容，可以是字符串，也可以是一个`stream`对象（比如可读数据流）或`buffer`对象（表示二进制数据），另一个是写入完成后的回调函数，它是可选的

#### 4.3 cork()，uncork()
- cork方法可以强制等待写入的数据进入缓存。当调用uncork方法或end方法时，缓存的数据就会吐出

#### 4.4 setDefaultEncoding()
- setDefaultEncoding方法用于将写入的数据编码成新的格式。它返回一个布尔值，表示编码是否成功，如果返回false就表示编码失败

#### 4.5 end()
- end方法用于终止“可写数据流”。该方法可以接受三个参数，全部都是可选参数。第一个参数是最后所要写入的数据，可以是字符串，也可以是stream对象或buffer对象

#### 4.6 事件
- drain事件
- finish事件
- pipe事件
- unpipe事件
- error事件

---
### 5. pipe 方法
- 你可能会问为什么数据库要部署“可写数据流”接口，而不是直接使用原始的写入接口。答案就是为了可以使用`pipe`方法

---
### 6.  转换数据流
- 转换数据流用于将可读数据流释放的数据，转换成另一种格式，然后再发给可写数据流

---
### 7. HTTP请求
- HTTP对象使用Stream接口，实现网络数据的读写

---
### 8. fs模块
- fs模块的createReadStream方法用于新建读取数据流，createWriteStream方法用于新建写入数据流

---
### 9. 错误处理
>略
