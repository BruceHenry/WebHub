### Web Worker
[教程地址：Web Worker](http://javascript.ruanyifeng.com/htmlapi/webworker.html)

---
### 目录
```
1. 概述
2. 新建和启动子线程
3. 子线程的事件监听
4. 主线程的事件监听
5. 错误处理
6. 关闭子线程
7. 主线程与子线程的数据通信
8. 同页面的Web Worker
9. 实例：Worker 进程完成论询
10. Service Worker
11. 参考链接
```

---
### 1. 概述
- JavaScript语言采用的是单线程模型，也就是说，所有任务排成一个队列，一次只能做一件事。随着电脑计算能力的增强，尤其是多核CPU的出现，这一点带来很大的不便，无法充分发挥JavaScript的潜力
- Web Worker的目的，就是为JavaScript创造多线程环境，允许主线程将一些任务分配给子线程。在主线程运行的同时，子线程在后台运行，两者互不干扰
- 因此，每一个子线程就好像一个“工人”（worker），默默地完成自己的工作。这样做的好处是，一些高计算量或高延迟的工作，被worker线程负担了，所以主进程（通常是UI进程）就会很流畅，不会被阻塞或拖慢
- Worker线程分成好几种
  *   普通的Worker：只能与创造它们的主进程通信。
  *   Shared Worker：能被所有同源的进程获取（比如来自不同的浏览器窗口、iframe窗口和其他Shared worker），它们必须通过一个端口通信。
  *   ServiceWorker：实际上是一个在网络应用与浏览器或网络层之间的代理层。它可以拦截网络请求，使得离线访问成为可能
- Web Worker有以下几个特点
   *   **同域限制**。子线程加载的脚本文件，必须与主线程的脚本文件在同一个域。
  *   **DOM限制**。子线程所在的全局对象，与主进程不一样，它无法读取网页的DOM对象，即`document`、`window`、`parent`这些对象，子线程都无法得到。（但是，`navigator`对象和`location`对象可以获得。）
  *   **脚本限制**。子线程无法读取网页的全局变量和函数，也不能执行alert和confirm方法，不过可以执行setInterval和setTimeout，以及使用XMLHttpRequest对象发出AJAX请求。
  *   **文件限制**。子线程无法读取本地文件，即子线程无法打开本机的文件系统（file://），它所加载的脚本，必须来自网络

---
### 2. 新建和启动子线程
- 主线程采用`new`命令，调用`Worker`构造函数，可以新建一个子线程
- Worker构造函数的参数是一个脚本文件，这个文件就是子线程所要完成的任务

---
### 3. 子线程的事件监听
- 在子线程内，必须有一个回调函数，监听message事件
- self代表子线程自身，self.addEventListener表示对子线程的message事件指定回调函数（直接指定onmessage属性的值也可）。回调函数的参数是一个事件对象，它的data属性包含主线程发来的信号。self.postMessage则表示，子线程向主线程发送一个信号

---
### 4. 主线程的事件监听
- 主线程也必须指定message事件的回调函数，监听子线程发来的信号

---
### 5. 错误处理
- 主线程可以监听子线程是否发生错误。如果发生错误，会触发主线程的error事件

---
### 6. 关闭子线程
- 使用完毕之后，为了节省系统资源，我们必须在主线程调用terminate方法，手动关闭子线程
- 也可以子线程内部关闭自身

---
### 7. 主线程与子线程的数据通信
- 前面说过，主线程与子线程之间的通信内容，可以是文本，也可以是对象。需要注意的是，这种通信是拷贝关系，即是传值而不是传址，子线程对通信内容的修改，不会影响到主线程。事实上，浏览器内部的运行机制是，先将通信内容串行化，然后把串行化后的字符串发给子线程，后者再将它还原
- 主线程与子线程之间也可以交换二进制数据，比如File、Blob、ArrayBuffer等对象，也可以在线程之间发送

---
### 8. 同页面的Web Worker
- 通常情况下，子线程载入的是一个单独的JavaScript文件，但是也可以载入与主线程在同一个网页的代码

---
### 9. 实例：Worker 进程完成论询
- 有时，浏览器需要论询服务器状态，以便第一时间得知状态改变。这个工作可以放在 Worker 进程里面

---
### 10. Service Worker
- Service worker是一个在浏览器后台运行的脚本，与网页不相干，专注于那些不需要网页或用户互动就能完成的功能。它主要用于操作离线缓存
