### 5.1 单线程模型
[教程地址： 5.1 单线程模型](http://javascript.ruanyifeng.com/advanced/single-thread.html)

---
### 目录
```
1. 含义
2. 消息队列
3. Event Loop
```

---
### 1. 含义
- 单线程模型指的是，JavaScript只在一个线程上运行。也就是说，JavaScript同时只能执行一个任务，其他任务都必须在后面排队等待
- 注意，JavaScript只在一个线程上运行，不代表JavaScript引擎只有一个线程。事实上，JavaScript引擎有多个线程，单个脚本只能在一个线程上运行，其他线程都是在后台配合
- 为了利用多核CPU的计算能力，HTML5提出Web Worker标准，允许JavaScript脚本创建多个线程，但是子线程完全受主线程控制，且不得操作DOM。所以，这个新标准并没有改变JavaScript单线程的本质
- 单线程模型带来了一些问题,如果有一个任务特别耗时，后面的任务都会停在那里等待，造成浏览器失去响应，又称“假死”。为了避免“假死”
- 但是很多时候CPU是闲着的，因为IO设备（输入输出设备）很慢,JavaScript语言的设计者意识到，这时CPU完全可以不管IO设备，挂起处于等待中的任务，先运行排在后面的任务,这种机制就是JavaScript内部采用的Event Loop机制

---
### 2. 消息队列
- JavaScript运行时，除了一个运行线程，引擎还提供一个消息队列（message queue），里面是各种需要当前程序处理的消息。新的消息进入队列的时候，会自动排在队列的尾端
- 运行线程只要发现消息队列不为空，就会取出排在第一位的那个消息，执行它对应的回调函数。等到执行完，再取出排在第二位的消息，不断循环，直到消息队列变空为止
- 每条消息与一个回调函数相联系，也就是说，程序只要收到这条消息，就会执行对应的函数。另一方面，进入消息队列的消息，必须有对应的回调函数。否则这个消息就会遗失，不会进入消息队列
- 另一种情况是`setTimeout`会在指定时间向消息队列添加一条消息。如果消息队列之中，此时没有其他消息，这条消息会立即得到处理；否则，这条消息会不得不等到其他消息处理完，才会得到处理。因此，`setTimeout`指定的执行时间，只是一个最早可能发生的时间，并不能保证一定会在那个时间发生

---
### 3. Event Loop
- 所谓Event Loop机制，指的是一种内部循环，用来一轮又一轮地处理消息队列之中的消息，即执行对应的回调函数
- 可以就把Event Loop理解成动态更新的消息队列本身
- 下面是一些常见的JavaScript任务
   *   执行JavaScript代码
   *   对用户的输入（包含鼠标点击、键盘输入等等）做出反应
   *   处理异步的网络请求

- 所有任务可以分成两种，一种是同步任务（synchronous），另一种是异步任务（asynchronous）
- 同步任务指的是，在JavaScript执行进程上排队执行的任务，只有前一个任务执行完毕，才能执行后一个任务
- 异步任务指的是，不进入JavaScript执行进程、而进入“任务队列”（task queue）的任务，只有“任务队列”通知主进程，某个异步任务可以执行了，该任务（采用回调函数的形式）才会进入JavaScript进程执行
- 以Ajax操作为例，它可以当作同步任务处理，也可以当作异步任务处理，由开发者决定
- 虽然JavaScript只有一个进程用来执行，但是并行的还有其他进程（比如，处理定时器的进程、处理用户输入的进程、处理网络通信的进程等等）。这些进程通过向任务队列添加任务，实现与JavaScript进程通信
- 单线程模型虽然对JavaScript构成了很大的限制，但也因此使它具备了其他语言不具备的优势。如果部署得好，JavaScript程序是不会出现堵塞的，这就是为什么node.js平台可以用很少的资源，应付大流量访问的原因
